import { useRef } from "react";
import useScrollEffect from "../../hooks/useScrollEffect";
import styled from "@emotion/styled";

const Wrapper = styled("div")`
  .drawpath-root {
    position: absolute;
    z-index: -1;
    top: 80vh;
    left: 20%;
  }

  .drawpath-path {
    stroke-width: 4px;
  }
`;

export default function DrawPath() {
  const parentRef = useRef();
  const pathRef = useRef();

  const calcDashoffset = (scrollY, element, length) => {
    const ratio = (scrollY - element.offsetTop) / element.offsetHeight;
    const value = length - length * ratio;
    return value < 0 ? 0 : value > length ? length : value;
  };

  const scrollHandler = () => {
    const path = pathRef.current;
    const content = parentRef.current;
    const pathLength = path.getTotalLength();
    path.style.strokeDasharray = pathLength;
    path.style.strokeDashoffset = pathLength;

    const scrollY = window.scrollY + window.innerHeight * 0.8;
    path.style.strokeDashoffset = calcDashoffset(scrollY, content, pathLength);
  };

  useScrollEffect(() => {
    scrollHandler();
  });

  return (
    <Wrapper>
      <div className="drawpath-root" ref={parentRef}>
        <svg width="1442" height="2576" viewBox="0 0 1442 2576" fill="none">
          <path
            ref={pathRef}
            className="drawpath-path"
            d="M4.92432 309.052C29.2536 303.886 90.7101 278.259 141.902 217.074C149.9 208.276 158.566 219.74 161.898 226.572C176.229 251.899 217.089 301.953 265.881 299.554C326.871 296.555 352.367 253.565 361.365 191.58C370.364 129.595 373.363 130.595 393.86 99.1029C414.356 67.6105 422.355 29.1199 406.858 13.6237C391.36 -1.87253 368.864 -3.37216 366.364 10.6244C363.865 24.621 340.869 61.1121 334.37 69.6101C327.871 78.108 282.878 157.589 220.889 165.587C205.891 165.587 204.891 159.088 226.388 134.094C247.884 109.1 270.88 77.6081 274.88 71.6096C278.879 65.611 290.377 51.6144 312.373 49.6149C329.97 48.0153 412.023 38.9509 450.85 34.6186C460.515 33.9521 490.344 35.5184 532.337 47.1155C584.828 61.612 640.819 73.6091 644.318 75.6086C647.818 77.6081 660.816 82.107 650.817 99.1029C640.819 116.099 611.824 119.098 605.825 119.098C599.826 119.098 536.336 112.6 532.337 110.6C528.338 108.601 476.846 108.101 463.848 116.599C450.85 125.097 414.856 131.595 384.861 184.582C354.866 237.569 371.864 301.054 381.862 317.55C391.86 334.046 408.357 366.038 454.35 386.533C500.342 407.028 566.831 392.032 583.328 377.535C599.826 363.039 645.318 337.545 654.317 264.563C663.315 191.58 593.827 128.596 583.328 127.096C572.83 125.596 563.832 127.596 557.833 129.595C551.834 131.595 528.838 143.592 521.339 150.59C513.84 157.589 487.344 147.091 483.845 145.592C480.346 144.092 467.348 132.095 460.849 150.59C455.65 165.387 440.352 172.418 433.353 174.085C432.52 180.583 433.453 192.38 443.852 187.581C456.849 181.583 469.347 177.584 478.346 184.582C487.344 191.58 496.343 196.079 487.344 207.576C483.845 214.575 457.849 202.078 454.35 202.578C450.85 203.078 437.353 196.579 420.355 214.075C414.356 223.073 416.856 230.071 413.357 237.569C409.857 245.067 405.858 262.063 415.356 264.563C424.855 267.062 437.353 269.561 445.851 281.059C454.35 292.556 453.85 313.051 457.349 336.045C460.849 359.04 480.845 355.041 487.344 345.543C493.843 336.045 505.341 319.549 504.841 315.05C504.342 310.551 506.841 299.054 510.341 290.056C513.84 281.059 525.838 272.561 524.838 268.562C523.838 264.563 521.339 242.068 532.337 241.568C543.335 241.068 554.333 227.572 564.832 248.067C568.831 254.565 566.831 261.563 591.327 259.064C615.823 256.565 624.322 237.569 625.821 229.071C627.321 220.573 626.821 202.578 616.323 202.578C605.825 202.578 607.324 226.072 619.322 259.064C631.32 292.056 628.821 285.058 616.323 300.054C607.824 311.051 608.324 317.55 608.824 322.049C609.324 326.547 604.325 329.547 597.826 331.546C591.327 333.546 591.327 335.045 591.327 355.041C591.327 375.036 594.327 385.533 576.829 399.53C557.333 411.027 511.34 417.525 482.845 410.527C454.35 403.529 376.363 370.537 370.364 370.037C364.365 369.537 314.373 363.538 316.373 389.032C323.172 406.228 370.197 430.189 392.86 440.02C419.689 456.349 475.246 489.308 482.845 490.508C492.343 492.007 503.342 500.505 535.336 500.505C567.331 500.505 631.32 519.5 637.819 519.5C644.318 519.5 663.315 526.499 693.31 500.505C723.305 474.511 775.796 449.518 765.798 440.02C755.8 430.522 739.802 428.023 707.308 438.02C674.813 448.018 614.823 500.005 606.325 504.004C597.826 508.003 571.83 546.494 566.331 546.494C560.832 546.494 535.336 547.994 535.336 514.002C535.336 480.01 552.333 467.513 591.327 432.022C630.321 396.53 622.822 371.037 630.321 363.039C637.819 355.041 662.315 267.062 757.799 294.555C810.291 304.553 823.15 356.308 832.787 367.411C855.783 393.904 884.778 374.409 895.277 371.41C905.775 368.411 949.268 349.042 1016.76 354.041C1114.24 361.261 1123.24 374.909 1138.74 407.028C1164.43 460.27 1060.28 585.267 1045.75 594.482C1026.25 606.852 930.271 641.471 859.283 657.467C788.294 673.463 644.318 710.454 630.321 790.435C618.323 855.919 680.312 845.421 727.305 867.916C774.297 890.41 769.797 872.914 906.775 968.891C958.766 1008.88 1082.25 1016.38 1103.24 1014.88C1124.24 1013.38 1165.73 1020.88 1178.73 1054.37C1191.73 1087.86 1147.02 1075.83 1131.24 1086.36C1072.25 1125.73 1069.25 1141.5 1017.26 1132.35C983 1121 950.767 1111.7 928.771 1132.35C906.775 1153 917.219 1177 894 1189.5C870.781 1202 856.5 1232 850.784 1238.83C842.968 1248.16 783.295 1315.31 810.291 1353.3C837.286 1391.29 889.278 1413.78 889.278 1413.78C887.111 1422.95 870.781 1455.77 870.781 1455.77C867.781 1455.77 862.682 1452.77 866.281 1440.78C870.781 1425.78 858.283 1419.78 850.784 1419.28C843.285 1418.78 831.787 1410.78 831.787 1404.28C831.787 1397.79 815.79 1394.79 810.291 1404.28C804.792 1413.78 800.292 1413.78 796.793 1413.78C793.993 1413.78 802.959 1398.12 807.791 1390.29C809.124 1386.96 794.293 1377.29 794.293 1377.29C792.96 1376.13 791.594 1371.39 796.793 1361.8C803.292 1349.8 781.477 1350.12 778.296 1353.3C774.797 1356.8 763.299 1377.29 774.797 1381.79C777.796 1382.46 784.295 1383.39 786.295 1381.79C787.795 1380.96 789.894 1381.49 786.295 1390.29C781.796 1401.29 773.797 1403.78 790.794 1416.28C807.791 1428.78 787.794 1435.28 802.792 1444.28C817.79 1453.27 828.288 1430.28 831.787 1426.28C835.287 1422.28 839.286 1420.28 837.286 1430.78C835.287 1441.28 812.29 1464.27 838.786 1472.77C848.384 1479.17 857.783 1469.44 861.282 1463.77C864.115 1463.6 869.681 1464.97 869.281 1471.77C868.781 1480.27 875.28 1494.26 883.779 1496.76C892.277 1499.26 910.274 1496.76 917.773 1471.77C925.272 1446.77 922.272 1432.78 911.774 1423.28C901.276 1413.78 923.272 1404.28 927.771 1404.28C932.27 1404.28 942.269 1373.29 937.27 1355.8C932.271 1338.3 919.773 1288.81 934.77 1264.82C949.768 1240.82 966.821 1247.76 996.26 1222.83C1012 1209.5 1023.76 1169.34 1057.75 1162.84C1091.74 1156.35 1103.24 1152.35 1122.74 1183.34C1138.34 1208.13 1112.57 1239.99 1097.74 1252.82C1076.41 1261.15 1032.65 1284.81 1028.25 1312.81C1028.25 1331.3 1034.64 1328.9 1026.26 1338.5C1017.26 1348.8 1010.26 1341.8 1003.26 1348.8C996.26 1355.8 973.764 1374.29 978.763 1401.29C983.762 1428.28 1006.26 1416.28 1017.26 1408.78C1028.25 1401.29 1027.75 1415.28 1026.26 1419.28C1024.76 1423.28 1029.75 1442.28 1046.75 1434.28C1063.75 1426.28 1065.75 1401.29 1069.25 1401.29C1072.75 1401.29 1075.25 1399.29 1072.25 1411.28C1069.25 1423.28 1067.75 1442.78 1088.24 1436.78C1108.74 1430.78 1094.24 1423.78 1119.24 1430.28C1130.04 1430.28 1133.4 1415.95 1133.74 1408.78C1134.07 1406.95 1135.84 1404.88 1140.24 1411.28C1145.74 1419.28 1152.73 1418.28 1157.73 1411.28C1162.73 1404.28 1169.23 1387.79 1154.73 1386.29C1147.23 1386.29 1147.34 1382.79 1140.24 1398.29C1135.57 1395.95 1126.98 1393.86 1122.74 1396.29C1119.24 1398.29 1114.24 1398.29 1109.24 1416.28C1106.74 1418.61 1102.04 1420.38 1103.24 1408.78C1104.44 1397.19 1099.41 1394.29 1096.74 1394.29C1091.14 1391.09 1084.08 1394.29 1081.25 1396.29C1076.91 1395.12 1067.55 1391.89 1064.75 1388.29C1061.25 1383.79 1045.27 1379.73 1037.75 1391.29C1031.25 1401.29 1033.25 1398.29 1028.25 1398.29C1027.59 1395.79 1027.95 1388.09 1034.75 1377.29C1034.75 1360.3 1042.75 1356.8 1044.75 1356.8C1060.92 1364.29 1095.84 1378.89 1106.24 1377.29C1119.24 1375.29 1154.73 1378.29 1179.73 1344.8C1199.73 1318.01 1199.39 1247.99 1196.73 1216.33C1196.06 1208.33 1197.13 1188.44 1206.73 1172.84C1218.72 1153.35 1226.72 1115.36 1209.72 1095.86C1192.73 1076.36 1212.72 1059.87 1225.72 1060.87C1238.72 1061.87 1271.71 1066.37 1328.7 1106.86C1374.3 1139.25 1393.36 1179.84 1395.69 1195.84C1395.69 1195.84 1447.19 1348.8 1435.19 1419.28C1430.23 1448.39 1398.69 1600.24 1349.2 1696.21C1299.71 1792.19 1250.72 1859.17 1237.22 1942.65C1223.72 2026.13 1206.73 2129.48 1268.21 2191.09C1282.12 2205.03 1305.71 2238.58 1320.71 2271.07C1331.62 2294.72 1337.04 2393.08 1320.71 2433.41C1310.43 2458.77 1311.61 2496.32 1221.22 2511.52C1128.44 2518.31 1083.25 2517.35 1072.25 2516.01C1019.26 2515.68 907.175 2514.31 882.779 2511.52C880.779 2511.52 879.946 2508.52 879.779 2507.02C875.113 2494.52 859.983 2469.73 836.786 2470.53C807.791 2471.53 784.795 2494.52 785.295 2524.01C785.795 2553.51 812.79 2569 832.287 2567C851.784 2565 871.281 2552.51 879.779 2536.01C888.278 2519.51 865.282 2475.52 859.283 2470.53C853.284 2465.53 818.789 2432.53 857.783 2386.55C896.776 2340.56 943.769 2347.06 982.762 2271.07C1013.96 2210.29 985.095 2145.1 966.765 2120.11C949.268 2100.78 901.276 2062.42 849.284 2063.62C784.295 2065.12 726.305 2103.11 698.809 2158.6C671.314 2214.09 708.308 2223.09 718.806 2227.08C729.304 2231.08 762.299 2209.59 781.796 2181.1C801.292 2152.6 862.782 2141.11 886.778 2179.1C910.774 2217.09 879.779 2267.57 868.781 2274.07C857.783 2280.57 802.792 2322.06 798.293 2328.56C793.793 2335.06 761.299 2359.55 786.795 2421.54C792.96 2427.37 810.691 2439.93 832.287 2443.53C859.283 2448.03 882.779 2465.53 888.778 2488.52C894.777 2511.52 888.778 2537.56 863.5 2557C856 2562.77 843.585 2565.16 836.786 2566.36C829.988 2567.56 785.854 2564 785.854 2530.5"
            stroke="black"
          />
        </svg>
      </div>
    </Wrapper>
  );
}
